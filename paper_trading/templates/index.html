<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Paper Trading Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <style>
        .card {
            margin-bottom: 1rem;
        }
        .metric-card {
            text-align: center;
            padding: 1rem;
        }
        .metric-value {
            font-size: 1.5rem;
            font-weight: bold;
        }
        .metric-label {
            font-size: 0.9rem;
            color: #666;
        }
        .positive {
            color: #28a745;
        }
        .negative {
            color: #dc3545;
        }
        .chart-container {
            height: 400px;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-dark bg-dark">
        <div class="container-fluid">
            <span class="navbar-brand mb-0 h1">Paper Trading Dashboard</span>
        </div>
    </nav>

    <div class="container-fluid mt-3">
        <div class="row">
            <!-- Portfolio Summary -->
            <div class="col-md-3">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title mb-0">Portfolio Summary</h5>
                    </div>
                    <div class="card-body">
                        <div class="metric-card">
                            <div class="metric-value" id="total-value">$0.00</div>
                            <div class="metric-label">Total Value</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value" id="total-pnl">$0.00</div>
                            <div class="metric-label">Total P&L</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value" id="leverage">0.00x</div>
                            <div class="metric-label">Leverage</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value" id="margin-level">100%</div>
                            <div class="metric-label">Margin Level</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Performance Metrics -->
            <div class="col-md-3">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title mb-0">Performance Metrics</h5>
                    </div>
                    <div class="card-body">
                        <div class="metric-card">
                            <div class="metric-value" id="sharpe-ratio">0.00</div>
                            <div class="metric-label">Sharpe Ratio</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value" id="sortino-ratio">0.00</div>
                            <div class="metric-label">Sortino Ratio</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value" id="win-rate">0%</div>
                            <div class="metric-label">Win Rate</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value" id="profit-factor">0.00</div>
                            <div class="metric-label">Profit Factor</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Risk Metrics -->
            <div class="col-md-3">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title mb-0">Risk Metrics</h5>
                    </div>
                    <div class="card-body">
                        <div class="metric-card">
                            <div class="metric-value" id="volatility">0%</div>
                            <div class="metric-label">Volatility</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value" id="var-95">0%</div>
                            <div class="metric-label">VaR(95%)</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value" id="max-drawdown">0%</div>
                            <div class="metric-label">Max Drawdown</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value" id="correlation">0.00</div>
                            <div class="metric-label">Portfolio Correlation</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recent Alerts -->
            <div class="col-md-3">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title mb-0">Recent Alerts</h5>
                    </div>
                    <div class="card-body">
                        <div id="alerts-list" style="max-height: 300px; overflow-y: auto;">
                            <!-- Alerts will be inserted here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row mt-3">
            <!-- Performance Chart -->
            <div class="col-md-8">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title mb-0">Performance Chart</h5>
                    </div>
                    <div class="card-body">
                        <div id="performance-chart" class="chart-container"></div>
                    </div>
                </div>
            </div>

            <!-- Recent Trades -->
            <div class="col-md-4">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title mb-0">Recent Trades</h5>
                    </div>
                    <div class="card-body">
                        <div id="trades-list" style="max-height: 400px; overflow-y: auto;">
                            <!-- Trades will be inserted here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row mt-3">
            <!-- Current Positions -->
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title mb-0">Current Positions</h5>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>Symbol</th>
                                        <th>Side</th>
                                        <th>Quantity</th>
                                        <th>Entry Price</th>
                                        <th>Current Price</th>
                                        <th>Unrealized P&L</th>
                                        <th>Leverage</th>
                                    </tr>
                                </thead>
                                <tbody id="positions-table">
                                    <!-- Positions will be inserted here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Initialize Socket.IO connection
        const socket = io();

        // Handle real-time updates
        socket.on('metrics_update', function(data) {
            updateMetrics(data);
        });

        socket.on('positions_update', function(data) {
            updatePositions(data);
        });

        socket.on('trades_update', function(data) {
            updateTrades(data);
        });

        socket.on('alerts_update', function(data) {
            updateAlerts(data);
        });

        // Update portfolio metrics
        function updateMetrics(data) {
            document.getElementById('total-value').textContent = formatCurrency(data.total_value);
            document.getElementById('total-pnl').textContent = formatCurrency(data.total_pnl);
            document.getElementById('leverage').textContent = data.leverage.toFixed(2) + 'x';
            document.getElementById('margin-level').textContent = data.margin_level.toFixed(2) + '%';
            
            document.getElementById('sharpe-ratio').textContent = data.sharpe_ratio.toFixed(2);
            document.getElementById('sortino-ratio').textContent = data.sortino_ratio.toFixed(2);
            document.getElementById('win-rate').textContent = (data.win_rate * 100).toFixed(2) + '%';
            document.getElementById('profit-factor').textContent = data.profit_factor.toFixed(2);
            
            document.getElementById('volatility').textContent = (data.volatility * 100).toFixed(2) + '%';
            document.getElementById('var-95').textContent = (data.var_95 * 100).toFixed(2) + '%';
            document.getElementById('max-drawdown').textContent = (data.max_drawdown * 100).toFixed(2) + '%';
            document.getElementById('correlation').textContent = data.correlation.toFixed(2);
        }

        // Update positions table
        function updatePositions(positions) {
            const tbody = document.getElementById('positions-table');
            tbody.innerHTML = '';
            
            for (const [symbol, position] of Object.entries(positions)) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${symbol}</td>
                    <td>${position.side}</td>
                    <td>${position.quantity.toFixed(4)}</td>
                    <td>${formatCurrency(position.average_price)}</td>
                    <td>${formatCurrency(position.current_price)}</td>
                    <td class="${position.unrealized_pnl >= 0 ? 'positive' : 'negative'}">
                        ${formatCurrency(position.unrealized_pnl)}
                    </td>
                    <td>${position.leverage.toFixed(2)}x</td>
                `;
                tbody.appendChild(row);
            }
        }

        // Update trades list
        function updateTrades(trades) {
            const container = document.getElementById('trades-list');
            container.innerHTML = '';
            
            trades.forEach(trade => {
                const div = document.createElement('div');
                div.className = 'card mb-2';
                div.innerHTML = `
                    <div class="card-body">
                        <div class="d-flex justify-content-between">
                            <div>
                                <strong>${trade.symbol}</strong>
                                <span class="badge ${trade.side === 'buy' ? 'bg-success' : 'bg-danger'}">
                                    ${trade.side.toUpperCase()}
                                </span>
                            </div>
                            <div class="${trade.pnl >= 0 ? 'positive' : 'negative'}">
                                ${formatCurrency(trade.pnl)}
                            </div>
                        </div>
                        <div class="small text-muted">
                            ${formatDateTime(trade.timestamp)}
                        </div>
                    </div>
                `;
                container.appendChild(div);
            });
        }

        // Update alerts list
        function updateAlerts(alerts) {
            const container = document.getElementById('alerts-list');
            container.innerHTML = '';
            
            alerts.forEach(alert => {
                const div = document.createElement('div');
                div.className = 'alert alert-warning mb-2';
                div.innerHTML = `
                    <strong>${alert.type}</strong>
                    <div>${alert.message}</div>
                    <small class="text-muted">${formatDateTime(alert.timestamp)}</small>
                `;
                container.appendChild(div);
            });
        }

        // Format currency
        function formatCurrency(value) {
            return '$' + value.toFixed(2).replace(/\d(?=(\d{3})+\.)/g, '$&,');
        }

        // Format datetime
        function formatDateTime(timestamp) {
            return new Date(timestamp).toLocaleString();
        }

        // Load initial data
        fetch('/api/portfolio')
            .then(response => response.json())
            .then(data => {
                updateMetrics(data.metrics);
                updatePositions(data.positions);
                updateTrades(data.recent_trades);
            });

        fetch('/api/performance')
            .then(response => response.json())
            .then(data => {
                if (data.chart) {
                    const chartData = JSON.parse(data.chart);
                    Plotly.newPlot('performance-chart', chartData.data, chartData.layout);
                }
            });

        fetch('/api/alerts')
            .then(response => response.json())
            .then(data => {
                updateAlerts(data);
            });
    </script>
</body>
</html> 